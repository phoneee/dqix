

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="./">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>DQIX Refactoring Guide &mdash; DQIX  documentation</title>
      <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=b86133f3" />
      <link rel="stylesheet" type="text/css" href="_static/css/theme.css?v=e59714d7" />

  
      <script src="_static/jquery.js?v=5d32c60e"></script>
      <script src="_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="_static/documentation_options.js?v=5929fcd5"></script>
      <script src="_static/doctools.js?v=9bcbadda"></script>
      <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="index.html" class="icon icon-home">
            DQIX
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <!-- Local TOC -->
              <div class="local-toc"><ul>
<li><a class="reference internal" href="#">DQIX Refactoring Guide</a><ul>
<li><a class="reference internal" href="#overview">Overview</a></li>
<li><a class="reference internal" href="#key-refactoring-principles-applied">Key Refactoring Principles Applied</a><ul>
<li><a class="reference internal" href="#extract-method">1. Extract Method</a></li>
<li><a class="reference internal" href="#extract-class-mixin">2. Extract Class/Mixin</a></li>
<li><a class="reference internal" href="#unify-architecture">3. Unify Architecture</a></li>
</ul>
</li>
<li><a class="reference internal" href="#code-smells-eliminated">Code Smells Eliminated</a><ul>
<li><a class="reference internal" href="#duplicate-code">1. Duplicate Code</a></li>
<li><a class="reference internal" href="#long-methods">2. Long Methods</a></li>
<li><a class="reference internal" href="#large-classes">3. Large Classes</a></li>
<li><a class="reference internal" href="#inconsistent-interfaces">4. Inconsistent Interfaces</a></li>
</ul>
</li>
<li><a class="reference internal" href="#refactored-architecture">Refactored Architecture</a><ul>
<li><a class="reference internal" href="#new-structure">New Structure</a></li>
<li><a class="reference internal" href="#probe-architecture-pattern">Probe Architecture Pattern</a></li>
</ul>
</li>
<li><a class="reference internal" href="#benefits-achieved">Benefits Achieved</a><ul>
<li><a class="reference internal" href="#reduced-code-duplication">1. Reduced Code Duplication</a></li>
<li><a class="reference internal" href="#improved-maintainability">2. Improved Maintainability</a></li>
<li><a class="reference internal" href="#better-testability">3. Better Testability</a></li>
<li><a class="reference internal" href="#enhanced-readability">4. Enhanced Readability</a></li>
</ul>
</li>
<li><a class="reference internal" href="#guidelines-for-future-refactoring">Guidelines for Future Refactoring</a><ul>
<li><a class="reference internal" href="#when-to-refactor">When to Refactor</a></li>
<li><a class="reference internal" href="#red-flags-to-watch-for">Red Flags to Watch For</a></li>
<li><a class="reference internal" href="#refactoring-checklist">Refactoring Checklist</a></li>
</ul>
</li>
<li><a class="reference internal" href="#tools-and-techniques">Tools and Techniques</a><ul>
<li><a class="reference internal" href="#static-analysis">Static Analysis</a></li>
<li><a class="reference internal" href="#testing-during-refactoring">Testing During Refactoring</a></li>
</ul>
</li>
<li><a class="reference internal" href="#migration-strategy">Migration Strategy</a><ul>
<li><a class="reference internal" href="#phase-1-core-infrastructure">Phase 1: Core Infrastructure ✅</a></li>
<li><a class="reference internal" href="#phase-2-probe-refactoring-in-progress">Phase 2: Probe Refactoring (In Progress)</a></li>
<li><a class="reference internal" href="#phase-3-advanced-refactoring">Phase 3: Advanced Refactoring</a></li>
</ul>
</li>
<li><a class="reference internal" href="#examples">Examples</a><ul>
<li><a class="reference internal" href="#before-refactoring">Before Refactoring</a></li>
<li><a class="reference internal" href="#after-refactoring">After Refactoring</a></li>
</ul>
</li>
<li><a class="reference internal" href="#conclusion">Conclusion</a></li>
<li><a class="reference internal" href="#references">References</a></li>
</ul>
</li>
</ul>
</div>
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">DQIX</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">DQIX Refactoring Guide</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/REFACTORING_GUIDE.md.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section class="tex2jax_ignore mathjax_ignore" id="dqix-refactoring-guide">
<h1>DQIX Refactoring Guide<a class="headerlink" href="#dqix-refactoring-guide" title="Link to this heading"></a></h1>
<p>This document outlines the refactoring improvements made to the DQIX codebase and provides guidelines for future refactoring efforts.</p>
<section id="overview">
<h2>Overview<a class="headerlink" href="#overview" title="Link to this heading"></a></h2>
<p>The DQIX project has undergone systematic refactoring to improve code quality, maintainability, and consistency. This refactoring follows established principles from <a class="reference external" href="https://refactoring.guru/refactoring">Refactoring.Guru</a> and focuses on eliminating code smells while maintaining functionality.</p>
</section>
<section id="key-refactoring-principles-applied">
<h2>Key Refactoring Principles Applied<a class="headerlink" href="#key-refactoring-principles-applied" title="Link to this heading"></a></h2>
<section id="extract-method">
<h3>1. Extract Method<a class="headerlink" href="#extract-method" title="Link to this heading"></a></h3>
<p><strong>Problem</strong>: Long methods that do multiple things
<strong>Solution</strong>: Break down large methods into smaller, focused functions</p>
<p><strong>Example</strong>: The <code class="docutils literal notranslate"><span class="pre">main()</span></code> function in <code class="docutils literal notranslate"><span class="pre">dqix/cli.py</span></code> was refactored from 80+ lines to focused helper methods:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">_configure_verbosity_and_tls()</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">_load_and_validate_probes()</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">_expand_and_validate_targets()</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">_save_csv_results()</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">_save_json_results()</span></code></p></li>
</ul>
</section>
<section id="extract-class-mixin">
<h3>2. Extract Class/Mixin<a class="headerlink" href="#extract-class-mixin" title="Link to this heading"></a></h3>
<p><strong>Problem</strong>: Code duplication across probe classes
<strong>Solution</strong>: Created reusable mixins in <code class="docutils literal notranslate"><span class="pre">dqix/core/mixins.py</span></code></p>
<p><strong>Mixins Created</strong>:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">CacheMixin</span></code>: Common caching functionality</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">DomainValidationMixin</span></code>: Domain validation logic</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">DNSRecordMixin</span></code>: DNS record parsing utilities</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">ErrorHandlingMixin</span></code>: Consistent error handling</p></li>
</ul>
</section>
<section id="unify-architecture">
<h3>3. Unify Architecture<a class="headerlink" href="#unify-architecture" title="Link to this heading"></a></h3>
<p><strong>Problem</strong>: Two different probe base classes with inconsistent interfaces
<strong>Solution</strong>: Enhanced <code class="docutils literal notranslate"><span class="pre">dqix/core/probes.py</span></code> with unified <code class="docutils literal notranslate"><span class="pre">Probe</span></code> base class</p>
</section>
</section>
<section id="code-smells-eliminated">
<h2>Code Smells Eliminated<a class="headerlink" href="#code-smells-eliminated" title="Link to this heading"></a></h2>
<section id="duplicate-code">
<h3>1. Duplicate Code<a class="headerlink" href="#duplicate-code" title="Link to this heading"></a></h3>
<ul class="simple">
<li><p><strong>Before</strong>: Each probe implemented its own caching, validation, and error handling</p></li>
<li><p><strong>After</strong>: Common functionality extracted to mixins</p></li>
</ul>
</section>
<section id="long-methods">
<h3>2. Long Methods<a class="headerlink" href="#long-methods" title="Link to this heading"></a></h3>
<ul class="simple">
<li><p><strong>Before</strong>: <code class="docutils literal notranslate"><span class="pre">main()</span></code> function was 80+ lines handling multiple responsibilities</p></li>
<li><p><strong>After</strong>: Broken into focused 10-15 line methods with single responsibilities</p></li>
</ul>
</section>
<section id="large-classes">
<h3>3. Large Classes<a class="headerlink" href="#large-classes" title="Link to this heading"></a></h3>
<ul class="simple">
<li><p><strong>Before</strong>: Probe classes mixed data collection, scoring, caching, and validation</p></li>
<li><p><strong>After</strong>: Separated concerns using mixins and dedicated calculator classes</p></li>
</ul>
</section>
<section id="inconsistent-interfaces">
<h3>4. Inconsistent Interfaces<a class="headerlink" href="#inconsistent-interfaces" title="Link to this heading"></a></h3>
<ul class="simple">
<li><p><strong>Before</strong>: Two different probe base classes with different patterns</p></li>
<li><p><strong>After</strong>: Unified base class with consistent interface</p></li>
</ul>
</section>
</section>
<section id="refactored-architecture">
<h2>Refactored Architecture<a class="headerlink" href="#refactored-architecture" title="Link to this heading"></a></h2>
<section id="new-structure">
<h3>New Structure<a class="headerlink" href="#new-structure" title="Link to this heading"></a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>dqix/
├── core/
│   ├── probes.py          # Unified probe base class
│   ├── mixins.py          # Reusable functionality mixins
│   └── ...
├── probes/
│   ├── email/
│   │   ├── spf_refactored.py  # Example of refactored probe
│   │   └── ...
│   └── ...
└── ...
</pre></div>
</div>
</section>
<section id="probe-architecture-pattern">
<h3>Probe Architecture Pattern<a class="headerlink" href="#probe-architecture-pattern" title="Link to this heading"></a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="nd">@register</span>
<span class="k">class</span><span class="w"> </span><span class="nc">ExampleProbe</span><span class="p">(</span><span class="n">Probe</span><span class="p">,</span> <span class="n">CacheMixin</span><span class="p">,</span> <span class="n">DNSRecordMixin</span><span class="p">,</span> <span class="n">ErrorHandlingMixin</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Example probe following refactored pattern.&quot;&quot;&quot;</span>
    
    <span class="nb">id</span> <span class="o">=</span> <span class="s2">&quot;example&quot;</span>
    <span class="n">weight</span> <span class="o">=</span> <span class="mf">0.1</span>
    <span class="n">category</span> <span class="o">=</span> <span class="s2">&quot;security&quot;</span>
    
    <span class="k">def</span><span class="w"> </span><span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">domain</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Main probe logic - kept simple and focused.&quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># Check cache first</span>
            <span class="n">cached_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_cached_data</span><span class="p">(</span><span class="n">domain</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">cached_data</span><span class="p">:</span>
                <span class="n">data</span> <span class="o">=</span> <span class="n">ExampleData</span><span class="p">(</span><span class="o">**</span><span class="n">cached_data</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_collect_data</span><span class="p">(</span><span class="n">domain</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_cache_data</span><span class="p">(</span><span class="n">domain</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>
            
            <span class="n">score</span> <span class="o">=</span> <span class="n">ExampleScoreCalculator</span><span class="o">.</span><span class="n">calculate_score</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
            <span class="n">details</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_build_details</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
            
            <span class="k">return</span> <span class="n">score</span><span class="p">,</span> <span class="n">details</span>
            
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_handle_probe_error</span><span class="p">(</span><span class="n">domain</span><span class="p">,</span> <span class="n">e</span><span class="p">,</span> <span class="n">default_data</span><span class="p">)</span>
    
    <span class="k">def</span><span class="w"> </span><span class="nf">_collect_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">domain</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ExampleData</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Focused data collection method.&quot;&quot;&quot;</span>
        <span class="c1"># Implementation here</span>
        <span class="k">pass</span>
</pre></div>
</div>
</section>
</section>
<section id="benefits-achieved">
<h2>Benefits Achieved<a class="headerlink" href="#benefits-achieved" title="Link to this heading"></a></h2>
<section id="reduced-code-duplication">
<h3>1. Reduced Code Duplication<a class="headerlink" href="#reduced-code-duplication" title="Link to this heading"></a></h3>
<ul class="simple">
<li><p><strong>Before</strong>: ~40% code duplication across probe classes</p></li>
<li><p><strong>After</strong>: &lt;10% duplication with shared mixins</p></li>
</ul>
</section>
<section id="improved-maintainability">
<h3>2. Improved Maintainability<a class="headerlink" href="#improved-maintainability" title="Link to this heading"></a></h3>
<ul class="simple">
<li><p>Single point of change for common functionality</p></li>
<li><p>Consistent error handling and logging</p></li>
<li><p>Standardized caching behavior</p></li>
</ul>
</section>
<section id="better-testability">
<h3>3. Better Testability<a class="headerlink" href="#better-testability" title="Link to this heading"></a></h3>
<ul class="simple">
<li><p>Smaller, focused methods are easier to test</p></li>
<li><p>Mixins can be tested independently</p></li>
<li><p>Clear separation of concerns</p></li>
</ul>
</section>
<section id="enhanced-readability">
<h3>4. Enhanced Readability<a class="headerlink" href="#enhanced-readability" title="Link to this heading"></a></h3>
<ul class="simple">
<li><p>Methods have single responsibilities</p></li>
<li><p>Clear naming conventions</p></li>
<li><p>Consistent code structure</p></li>
</ul>
</section>
</section>
<section id="guidelines-for-future-refactoring">
<h2>Guidelines for Future Refactoring<a class="headerlink" href="#guidelines-for-future-refactoring" title="Link to this heading"></a></h2>
<section id="when-to-refactor">
<h3>When to Refactor<a class="headerlink" href="#when-to-refactor" title="Link to this heading"></a></h3>
<ol class="arabic simple">
<li><p><strong>Before adding new features</strong> - Clean up the area you’re working in</p></li>
<li><p><strong>When fixing bugs</strong> - Improve the code while you understand it</p></li>
<li><p><strong>During code reviews</strong> - Identify and address code smells</p></li>
<li><p><strong>Regular maintenance</strong> - Schedule periodic refactoring sessions</p></li>
</ol>
</section>
<section id="red-flags-to-watch-for">
<h3>Red Flags to Watch For<a class="headerlink" href="#red-flags-to-watch-for" title="Link to this heading"></a></h3>
<ol class="arabic simple">
<li><p><strong>Methods longer than 20 lines</strong> - Consider extracting methods</p></li>
<li><p><strong>Classes with more than 200 lines</strong> - Look for extraction opportunities</p></li>
<li><p><strong>Duplicate code blocks</strong> - Extract to shared utilities</p></li>
<li><p><strong>Complex conditional logic</strong> - Consider strategy pattern or guard clauses</p></li>
<li><p><strong>Long parameter lists</strong> - Consider parameter objects</p></li>
</ol>
</section>
<section id="refactoring-checklist">
<h3>Refactoring Checklist<a class="headerlink" href="#refactoring-checklist" title="Link to this heading"></a></h3>
<ul class="contains-task-list simple">
<li class="task-list-item"><p><input class="task-list-item-checkbox" disabled="disabled" type="checkbox"> All tests pass after refactoring</p></li>
<li class="task-list-item"><p><input class="task-list-item-checkbox" disabled="disabled" type="checkbox"> No new functionality added during refactoring</p></li>
<li class="task-list-item"><p><input class="task-list-item-checkbox" disabled="disabled" type="checkbox"> Code is more readable and maintainable</p></li>
<li class="task-list-item"><p><input class="task-list-item-checkbox" disabled="disabled" type="checkbox"> Common patterns extracted to reusable components</p></li>
<li class="task-list-item"><p><input class="task-list-item-checkbox" disabled="disabled" type="checkbox"> Documentation updated to reflect changes</p></li>
<li class="task-list-item"><p><input class="task-list-item-checkbox" disabled="disabled" type="checkbox"> Performance impact assessed (if any)</p></li>
</ul>
</section>
</section>
<section id="tools-and-techniques">
<h2>Tools and Techniques<a class="headerlink" href="#tools-and-techniques" title="Link to this heading"></a></h2>
<section id="static-analysis">
<h3>Static Analysis<a class="headerlink" href="#static-analysis" title="Link to this heading"></a></h3>
<p>Use tools to identify code smells:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Check code complexity</span>
flake8<span class="w"> </span>--max-complexity<span class="o">=</span><span class="m">10</span><span class="w"> </span>dqix/

<span class="c1"># Check for duplicated code</span>
pylint<span class="w"> </span>--disable<span class="o">=</span>all<span class="w"> </span>--enable<span class="o">=</span>duplicate-code<span class="w"> </span>dqix/

<span class="c1"># Type checking</span>
mypy<span class="w"> </span>dqix/
</pre></div>
</div>
</section>
<section id="testing-during-refactoring">
<h3>Testing During Refactoring<a class="headerlink" href="#testing-during-refactoring" title="Link to this heading"></a></h3>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Run tests frequently during refactoring</span>
pytest<span class="w"> </span>tests/<span class="w"> </span>-v

<span class="c1"># Check test coverage</span>
pytest<span class="w"> </span>--cov<span class="o">=</span>dqix<span class="w"> </span>tests/
</pre></div>
</div>
</section>
</section>
<section id="migration-strategy">
<h2>Migration Strategy<a class="headerlink" href="#migration-strategy" title="Link to this heading"></a></h2>
<section id="phase-1-core-infrastructure">
<h3>Phase 1: Core Infrastructure ✅<a class="headerlink" href="#phase-1-core-infrastructure" title="Link to this heading"></a></h3>
<ul class="contains-task-list simple">
<li class="task-list-item"><p><input class="task-list-item-checkbox" checked="checked" disabled="disabled" type="checkbox"> Create mixins for common functionality</p></li>
<li class="task-list-item"><p><input class="task-list-item-checkbox" checked="checked" disabled="disabled" type="checkbox"> Unify probe base class</p></li>
<li class="task-list-item"><p><input class="task-list-item-checkbox" checked="checked" disabled="disabled" type="checkbox"> Refactor CLI module</p></li>
</ul>
</section>
<section id="phase-2-probe-refactoring-in-progress">
<h3>Phase 2: Probe Refactoring (In Progress)<a class="headerlink" href="#phase-2-probe-refactoring-in-progress" title="Link to this heading"></a></h3>
<ul class="contains-task-list simple">
<li class="task-list-item"><p><input class="task-list-item-checkbox" disabled="disabled" type="checkbox"> Refactor email probes using new patterns</p></li>
<li class="task-list-item"><p><input class="task-list-item-checkbox" disabled="disabled" type="checkbox"> Refactor network probes</p></li>
<li class="task-list-item"><p><input class="task-list-item-checkbox" disabled="disabled" type="checkbox"> Refactor domain probes</p></li>
</ul>
</section>
<section id="phase-3-advanced-refactoring">
<h3>Phase 3: Advanced Refactoring<a class="headerlink" href="#phase-3-advanced-refactoring" title="Link to this heading"></a></h3>
<ul class="contains-task-list simple">
<li class="task-list-item"><p><input class="task-list-item-checkbox" disabled="disabled" type="checkbox"> Implement strategy pattern for scoring</p></li>
<li class="task-list-item"><p><input class="task-list-item-checkbox" disabled="disabled" type="checkbox"> Add plugin architecture improvements</p></li>
<li class="task-list-item"><p><input class="task-list-item-checkbox" disabled="disabled" type="checkbox"> Optimize performance bottlenecks</p></li>
</ul>
</section>
</section>
<section id="examples">
<h2>Examples<a class="headerlink" href="#examples" title="Link to this heading"></a></h2>
<section id="before-refactoring">
<h3>Before Refactoring<a class="headerlink" href="#before-refactoring" title="Link to this heading"></a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Long method with multiple responsibilities</span>
<span class="k">def</span><span class="w"> </span><span class="nf">main</span><span class="p">():</span>
    <span class="n">args</span> <span class="o">=</span> <span class="n">parse_args</span><span class="p">()</span>
    <span class="n">verbosity</span> <span class="o">=</span> <span class="mi">2</span> <span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">debug</span> <span class="k">else</span> <span class="p">(</span><span class="mi">1</span> <span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">verbose</span> <span class="k">else</span> <span class="mi">0</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">debug</span><span class="p">:</span>
        <span class="n">args</span><span class="o">.</span><span class="n">verbose</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="n">set_verbosity_level</span><span class="p">(</span><span class="n">verbosity</span><span class="p">)</span>
    <span class="n">set_tls_method</span><span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">tls_method</span><span class="p">)</span>
    <span class="n">probes</span> <span class="o">=</span> <span class="n">load_level</span><span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">level</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">probes</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error: No probes loaded for level </span><span class="si">{</span><span class="n">args</span><span class="o">.</span><span class="n">level</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span>
    <span class="c1"># ... 60+ more lines</span>
</pre></div>
</div>
</section>
<section id="after-refactoring">
<h3>After Refactoring<a class="headerlink" href="#after-refactoring" title="Link to this heading"></a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Clean, focused main method</span>
<span class="k">def</span><span class="w"> </span><span class="nf">main</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Main CLI entry point.&quot;&quot;&quot;</span>
    <span class="n">args</span> <span class="o">=</span> <span class="n">parse_args</span><span class="p">()</span>
    <span class="n">verbosity</span> <span class="o">=</span> <span class="n">_configure_verbosity_and_tls</span><span class="p">(</span><span class="n">args</span><span class="p">)</span>
    <span class="n">probes</span> <span class="o">=</span> <span class="n">_load_and_validate_probes</span><span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">level</span><span class="p">)</span>
    <span class="n">domains</span> <span class="o">=</span> <span class="n">_expand_and_validate_targets</span><span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">targets</span><span class="p">)</span>
    
    <span class="n">results</span> <span class="o">=</span> <span class="n">run_domains</span><span class="p">(</span><span class="n">domains</span><span class="p">,</span> <span class="n">probes</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="n">args</span><span class="o">.</span><span class="n">level</span><span class="p">,</span> 
                         <span class="n">threads</span><span class="o">=</span><span class="n">args</span><span class="o">.</span><span class="n">threads</span><span class="p">,</span> <span class="n">verbosity</span><span class="o">=</span><span class="n">verbosity</span><span class="p">,</span> <span class="n">debug</span><span class="o">=</span><span class="n">args</span><span class="o">.</span><span class="n">debug</span><span class="p">)</span>
    
    <span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">csv</span><span class="p">:</span>
        <span class="n">_save_csv_results</span><span class="p">(</span><span class="n">results</span><span class="p">,</span> <span class="n">args</span><span class="o">.</span><span class="n">csv</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">json_out</span><span class="p">:</span>
        <span class="n">_save_json_results</span><span class="p">(</span><span class="n">results</span><span class="p">,</span> <span class="n">args</span><span class="o">.</span><span class="n">json_out</span><span class="p">)</span>
    
    <span class="n">_display_single_domain_table</span><span class="p">(</span><span class="n">results</span><span class="p">,</span> <span class="n">probes</span><span class="p">,</span> <span class="n">verbosity</span><span class="p">)</span>
</pre></div>
</div>
</section>
</section>
<section id="conclusion">
<h2>Conclusion<a class="headerlink" href="#conclusion" title="Link to this heading"></a></h2>
<p>This refactoring effort has significantly improved the DQIX codebase by:</p>
<ul class="simple">
<li><p>Eliminating code duplication</p></li>
<li><p>Improving maintainability and readability</p></li>
<li><p>Establishing consistent patterns</p></li>
<li><p>Making the code more testable</p></li>
</ul>
<p>The refactored code follows the DQIX project principles of modularity, transparency, and maintainability while making it easier for contributors to add new probes and features.</p>
</section>
<section id="references">
<h2>References<a class="headerlink" href="#references" title="Link to this heading"></a></h2>
<ul class="simple">
<li><p><a class="reference external" href="https://refactoring.guru/refactoring">Refactoring.Guru</a> - Comprehensive refactoring guide</p></li>
<li><p><a class="reference external" href="https://www.amazon.com/Clean-Code-Handbook-Software-Craftsmanship/dp/0132350882">Clean Code by Robert Martin</a> - Code quality principles</p></li>
<li><p><a class="reference external" href="https://martinfowler.com/books/refactoring.html">Refactoring: Improving the Design of Existing Code by Martin Fowler</a> - Classic refactoring reference</p></li>
</ul>
</section>
</section>


           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2025, Your Organization.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>